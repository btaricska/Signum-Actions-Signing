      # ============================================================
      # CREATE FILE TO SIGN
      # ============================================================

      - name: Create file to sign
        shell: bash
        run: |
          # Use a workspace folder not under Git control
          mkdir -p "$GITHUB_WORKSPACE/$FILES_DIR"
          echo "Hello from Signum + PKCS11 demo" > "$GITHUB_WORKSPACE/$FILES_DIR/file.txt"

      # ============================================================
      # SIGN FILES USING SIGNUM AGENT'S BUILT-IN PKCS11
      # ============================================================

      - name: Sign files via Signum Agent
        shell: bash
        run: |
          for f in "$GITHUB_WORKSPACE/$FILES_DIR"/*; do
            docker exec $CONTAINER_NAME pkcs11-tool \
              --module /pkcs11/libkeyfactorpkcs11.so \
              --sign \
              --input-file "/mnt/$FILES_DIR/$(basename $f)" \
              --output-file "/mnt/$FILES_DIR/$(basename $f).sig" \
              --id B93E1D6BB2B7763DFE7775D3CAA6828ECEBABE89
          done

      # ============================================================
      # UPLOAD SIGNED FILES AS ARTIFACTS
      # ============================================================

      - name: Upload signed files
        uses: actions/upload-artifact@v4
        with:
          name: signed-files
          path: "$GITHUB_WORKSPACE/$FILES_DIR/*.sig"
